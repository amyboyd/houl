#{extends 'layout.html' /}
#{set title: 'Chat room' /}
#{set bodyId: 'active-refresh' /}
#{set 'moreScripts'} <script> var userNickName = "${user}"; </script> #{/}

<h1>
    You are now chatting as ${user}
    <a href="@{leave(user)}">Leave the chat room</a>
</h1> 

<div id="thread">
    #{list events}
        #{if _.type == 'message'}
            <div class="message ${_.user == user ? 'you' : ''}">
                <h2>${_.user}</h2>
                <p>
                    ${_.text}
                </p>
            </div>
        #{/if}
        #{if _.type == 'join'}
            <div class="message notice">
                <h2></h2>
                <p>
                    ${_.user} joined the room
                </p>
            </div>
        #{/if}
        #{if _.type == 'leave'}
            <div class="message notice">
                <h2></h2>
                <p>
                    ${_.user} left the room
                </p>
            </div>
        #{/if}
    #{/list}
</div>

<div id="new-message">
    #{form @say(user)}
        <input type="text" id="message" name="message" autocomplete="off">
        <input type="submit" value="send" id="send">
    #{/}
</div>
